<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title></title>
        <link rel="stylesheet" href="couplelog.css"/>
        <script type="text/javascript" src="http://yandex.st/js/jquery/1.3.2/_jquery.js"></script>
        <script type="text/javascript" src="jquery.lint.js"></script>
		<script type="text/javascript" src="couplelog.js"></script>
        <script type="text/javascript">
        	
            var /*currentUser = 'veged',*/
                tmpheact, tmpsheact,
                couplelog,
                data = {
                    title: 'Мытьё посуды',
                    he: {
                        user: 'veged',
                        count: 3,
                        action: 'Я помыл посуду.',
                        button: 'помыл'
                    },
                    she: {
                        user: 'lady_alice',
                        count: 5,
                        action: 'Я помыла посуду.',
                        button: 'помыла'
                    }
                };

            $(function(){
				
				$(".setup").hide();
				
                $(".title-text").val(data.title);
                $(".he-action-text").val(data.he.action);
                $(".she-action-text").val(data.she.action);
				
				$(".setup-button").click(function(){
					$("div:not(.setup-button)").hide();
                    $(".setup").show();
				});
				
                $(".he-action-text").mouseup(function(){
                    tmpheact = $selection.getText();
                });

                $(".she-action-text").mouseup(function(){
                    tmpsheact = $selection.getText();
                });
				
                $(".he-action-button").click(function(){
                    data.he.button = tmpheact;
                });

                $(".she-action-button").click(function(){
                    data.she.button = tmpsheact;
                });
				
				$(".setup-ok").click(function(){
					$(".setup").hide();
					$("div:not(.setup)").show();
					data.title = $(".title-text").val();
					data.he.action = $(".he-action-text").val();
					data.she.action = $(".she-action-text").val();
					data.he.count = 0;
					data.she.count = 0;
					if (couplelog !== undefined) {
					    couplelog.destroy();
					};
					
					couplelog = new CoupleLog(data, currentUser);
				});
				
				$(".button").click(function(){
				    if (this.value == 'Он') {
				        currentUser = 'veged';
				    } else if (this.value == 'Она') {
				        currentUser = 'lady_alice';
				    };
					
				    if (couplelog !== undefined) {
				        couplelog.destroy();
				    };

                couplelog = new CoupleLog(data, currentUser);
					
                });
            });	

			$selection = {
			    getText : function() {
			        var txt = '';
			        if (txt = window.getSelection) {
			            txt = window.getSelection().toString();
			        } else {
			            txt = document.selection.createRange().text;
			        }
			        return txt;
			    }
			}			
			
		</script>
	</head>
	<body>
		<div class="setup-button-div">
			<input type="button" value="Настройки" class="setup-button"/>
		</div>
		<div class="setup">
			<input type="text" class="title-text"/>
			<br />
            <input type="text" class="he-action-text"/>
            <input type="button" value="Сделать" class="he-action-button"/> кнопку из выделенного текста
			<br />
			<input type="text" class="she-action-text"/>
			<input type="button" value="Сделать" class="she-action-button"/> кнопку из выделенного текста
			<br />
			<input type="button" value="OK" class="setup-ok"/>
		</div>
        <div class="likelogin">
            <h1>Кто вы?</h1>
            <input type="button" value="Он" class="button"/>
            <input type="button" value="Она" class="button"/>
        </div>
    </body>
</html>
